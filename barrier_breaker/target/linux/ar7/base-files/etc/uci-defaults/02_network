#!/bin/sh
if [ -e "/sys/bus/mdio_bus/drivers/IC+ IP175A/1:00" -o \
     -e "/sys/bus/mdio_bus/drivers/IC+ IP17xx/1:00" ] && \
   [ -x /sbin/swconfig ];
then
	uci batch <<EOF
set network.eth0=switch
set network.eth0.name=eth0
set network.eth0.reset=1
set network.eth0.enable_vlan=1
set network.eth0_1=switch_vlan
set network.eth0_1.device=eth0
set network.eth0_1.vlan=1
set network.eth0_1.ports="0 1 2 3 4t"
commit network
EOF
	HAS_SWITCH=1
fi

if [ -n "$HAS_SWITCH" -o \
	-e "/sys/bus/mdio_bus/drivers/Infineon ADM6996/1:00" -o \
	-e "/sys/bus/mdio_bus/drivers/Marvell 88E6060/1:10" ]; then
	uci batch <<EOF
set network.lan.ifname=eth0.1
commit network
EOF
	HAS_SWITCH=1
fi

uci commit network
